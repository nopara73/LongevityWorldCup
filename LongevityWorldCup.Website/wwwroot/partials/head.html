<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<meta name="description" content="{{SEO_DESCRIPTION}}" />
<meta name="robots" content="{{SEO_ROBOTS}}" />
<link rel="canonical" href="{{SEO_CANONICAL_URL}}" />

<!-- Open Graph Meta Tags -->
<meta property="og:title" content="{{SEO_OG_TITLE}}" />
<meta property="og:description" content="{{SEO_OG_DESCRIPTION}}" />
<meta property="og:image" content="{{SEO_OG_IMAGE}}" />
<meta property="og:url" content="{{SEO_OG_URL}}" />
<meta property="og:type" content="website" />
<meta property="og:site_name" content="Longevity World Cup" />
<meta name="twitter:card" content="summary_large_image" />
<meta name="twitter:title" content="{{SEO_OG_TITLE}}" />
<meta name="twitter:description" content="{{SEO_OG_DESCRIPTION}}" />
<meta name="twitter:image" content="{{SEO_OG_IMAGE}}" />

<!-- Upgrade to onion if someone comes from Tor Browser -->
<link rel="alternate" type="application/tor-hidden-service" href="http://lwc7tszawiykmkjoq4u2yxramezkwbdys2wxr2fmf6sdr6ug5t36ckqd.onion">

<!-- Favicon Links -->
<link rel="icon" href="/assets/favicon.ico" type="image/x-icon" />
<link rel="icon" type="image/png" sizes="192x192" href="/assets/favicon-192x192.png" />
<link rel="apple-touch-icon" sizes="180x180" href="/assets/apple-touch-icon.png" />

<link rel="manifest" href="/assets/site.webmanifest">

<!-- Preconnect for FontAwesome and CDN -->
<link rel="preconnect" href="https://cdnjs.cloudflare.com" crossorigin="anonymous">
<link rel="preconnect" href="https://cdn.jsdelivr.net" crossorigin="anonymous">

<!-- Existing Stylesheets -->
<link rel="preload" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.1.1/css/all.min.css" as="style" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.1.1/css/all.min.css" crossorigin="anonymous">

<script src="https://cdn.jsdelivr.net/npm/chart.js" crossorigin="anonymous" defer></script>
<script src="https://cdn.jsdelivr.net/npm/validator@13.9.0/validator.min.js" crossorigin="anonymous" defer></script>

<!-- AOS CSS -->
<link href="https://cdnjs.cloudflare.com/ajax/libs/aos/2.3.4/aos.css" rel="stylesheet">
<!-- AOS JS -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/aos/2.3.4/aos.js" defer></script>

<script>
(function(){var v=Date.now();window.__v=v;document.write('<link rel="stylesheet" href="/css/badges.css?v='+v+'">');})();
</script>

<!--
Monkey-patch DOMContentLoaded to delay all handlers until modulesReady resolves.
Ensures imported modules (like PhenoAge) are available before any DOM logic runs.
Must appear before any other script that attaches DOMContentLoaded listeners.
-->
<script>
    ; (function () {
        const origAdd = document.addEventListener.bind(document);
        document.addEventListener = function (type, listener, options) {
            if (type === 'DOMContentLoaded') {
                // wrap every DOMContentLoaded handler to await modulesReady first
                origAdd('DOMContentLoaded', event => {
                    window.modulesReady
                        .then(() => listener.call(this, event))
                        .catch(err => {
                            console.error('module load failed before DOMContentLoaded:', err);
                            listener.call(this, event);
                        });
                }, options);
            } else {
                origAdd(type, listener, options);
            }
        };
    })();
</script>

<!--
Monkey-patch DOMContentLoaded to automatically refresh AOS animations
as soon as the DOM is ready. Ensures any [data-aos] elements already
in view will animate without manual calls.
Must appear before any other script that initializes or relies on AOS.
-->
<script>
    (function () {
        const origAdd = document.addEventListener.bind(document);
        document.addEventListener = function (type, listener, options) {
            if (type === 'DOMContentLoaded') {
                origAdd('DOMContentLoaded', event => {
                    try {
                        listener.call(this, event);
                    } finally {
                        if (window.AOS && typeof AOS.refresh === 'function') {
                            AOS.refresh();
                        }
                    }
                }, options);
            } else {
                origAdd(type, listener, options);
            }
        };
    })();
</script>

<script type="module">
    const __v = window.__v || Date.now();

    // kick off dynamic imports (they run in module scope,
    // so nothing leaks global except what each module explicitly
    // assigns to window, e.g. window.PhenoAge)
    window.modulesReady = Promise.all([
        import(`/js/misc.js?v=${__v}`),
        import(`/js/leagueIcons.js?v=${__v}`),
        import(`/js/pheno-age.js?v=${__v}`),
        import(`/js/bortz-age.js?v=${__v}`),
        import(`/js/badges.js?v=${__v}`),
        import(`/js/pro-discounts.js?v=${__v}`),
        import(`/js/proof-helpers.js?v=${__v}`),
        import(`/js/age-visualization.js?v=${__v}`)
    ]);
</script>

<!-- Structured Data -->
<script type="application/ld+json">{{SEO_STRUCTURED_DATA}}</script>

<!-- Google tag (gtag.js) -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-PSSCLBW37H"></script>
<script>
    window.dataLayer = window.dataLayer || [];
    function gtag() { dataLayer.push(arguments); }
    gtag('js', new Date());

    gtag('config', 'G-PSSCLBW37H');
</script>

<script>
    document.addEventListener('DOMContentLoaded', () => {
        AOS.init({
            duration: 800, // Animation duration in milliseconds
            easing: 'ease-in-out', // Easing function
            once: true, // Whether animation should happen only once while scrolling down
            offset: 50, // Reduced offset to trigger animations earlier
            disable: window.matchMedia('(prefers-reduced-motion: reduce)').matches, // Respect user preference
        });
    });
</script>